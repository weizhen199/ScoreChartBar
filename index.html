<!DOCTYPE html>
<html>
<head>
	<!--meta http-equiv="refresh" content="10"-->
	<title>Score</title>
	<link href="css/demo.css" rel="stylesheet" type="text/css" />
	<script src="js/jquery.min.js" type="text/javascript"></script>
	<script src="js/jqbar.js" type="text/javascript"></script>
	<link rel="stylesheet" href="css/jqbar.css" />
</head>

<body>

<div id="container">
	<div class="sortItem" id="bar-1" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-2" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-3" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-4" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-5" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-6" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-7" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-8" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-9" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-10" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-11" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-12" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-13" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-14" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-15" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-16" style="margin-bottom:11px;"></div>
	<div class="sortItem" id="bar-17" style="margin-bottom:11px;"></div>
</div>

<script type="text/javascript">
    var page = {
        _jsonData: null,
        init: function () {
            setInterval(function () {
                $.ajax({
                    url: "score.json?" + Math.random(),
                    type: "get",
                    dataType: "json",
                    success: function (data) {
                        if (page._jsonData == null) {
                            console.log("初始化");
                            page._jsonData = data;
                            page.show(data);
                        } else if (JSON.stringify(page._jsonData) == JSON.stringify(data)) {
                            console.log("一样");
                        } else {
                            console.log("不一样");
                            console.log(JSON.stringify(page._jsonData));
                            console.log(JSON.stringify(data));
                            page._jsonData = data;
                            page.show(data);
                        }
                    }
                })
            }, 3000);
        }, show: function (data) {
            var newData = JSON.parse(JSON.stringify(data));
            newData.sort(function(a, b) {
                return b.Score - a.Score
            });

            $.each(newData, function (i, item) {
                $('#bar-' + (i + 1).toString()).empty().jqbar({ label: item.Company, value: item.Score, barColor: item.Color });
            });
        }
    };
    $(function () {
        page.init();
    });
</script>

</body>
</html>